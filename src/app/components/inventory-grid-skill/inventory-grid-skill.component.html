@let actions = allowedActions();
@let disable = disabledSkillIds();

<div class="flex flex-wrap flex-row gap-2">
  @for (skill of skills(); track skill.id) {
    <app-icon-skill
      [skill]="skill"
      [compareSkill]="compareSkill()"
      [equippingHero]="compareWithEquippedHero()"
      (click)="skillClicked.emit(skill)"
      [tp]="contextMenu"
      [tpData]="skill"
      tpVariation="contextMenu"
      [class.cursor-pointer]="clickableSkills()"
      (mouseenter)="animateItem.set(skill.id)"
      (mouseleave)="animateItem.set('')"
      [class.opacity-50]="disable.includes(skill.id)"
      [class.pointer-events-none]="disable.includes(skill.id)"
    ></app-icon-skill>

    <ng-template #contextMenu let-hide let-item="data">
      @if (actions.length > 0) {
        <ul class="menu bg-base-200 rounded-box w-56 p-0 min-w-[300px]">
          <li class="menu-title">{{ item.name }} Lv.{{ item.dropLevel }}</li>

          <li>
            <a (click)="toggleFavorite(item); hide()">
              {{ item.isFavorite ? 'Unfavorite' : 'Favorite' }}
            </a>
          </li>

          @if (actions.includes('Salvage')) {
            <li [class.menu-disabled]="item.isFavorite">
              <a (click)="salvageItem(item); hide()">
                Salvage for {{ salvageValue(item) | number }} Mana
              </a>
            </li>
          }

          @if (actions.includes('Equip')) {
            @for (hero of allHeroes(); track $index) {
              <li>
                <details>
                  <summary>{{ hero.name }}</summary>
                  <ul>
                    @for (slot of 3 | repeat: 3; track $index) {
                      <li>
                        <a (click)="equipSkill(item, hero, $index); hide()">
                          @let eqItem = heroEquippedSkill(hero, $index);

                          @if (eqItem) {
                            Equip [
                            <span class="text-xs text-{{ eqItem.rarity }}">
                              {{ eqItem.name }} Lv.{{ eqItem.dropLevel }}
                            </span>
                            ]
                          } @else {
                            Equip [empty]
                          }
                        </a>
                      </li>
                    }
                  </ul>
                </details>
              </li>
            }
          }
        </ul>
      }
    </ng-template>
  } @empty {
    <div>No matching items in inventory.</div>
  }
</div>
